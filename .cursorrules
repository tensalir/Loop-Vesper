# Loop-Vesper — Cursor Rules (Vercel-safe)
These rules guide the AI assistant when editing this repo. **Goal: avoid Vercel deploy rejections** by preventing common `next build` lint/type failures.

## Always keep Vercel builds green
- **Do not introduce ESLint *errors***. Vercel runs `next build` and will fail on ESLint errors (warnings are OK, but avoid new ones when easy).
- When in doubt, prefer changes that are type-safe and lint-safe over “clever” refactors.

## JSX apostrophes / quotes (Vercel blocker)
We’ve hit `react/no-unescaped-entities` during deploy.

- **Never put raw apostrophes/quotes in JSX text nodes**.
- Use **HTML entities** or **wrap the string in a JS expression**.

Examples:
- Bad:
  - `<p>don't repeat it</p>`
- Good:
  - `<p>don&apos;t repeat it</p>`
  - `<p>{"don't repeat it"}</p>`

Common escapes:
- `&apos;` for `'`
- `&quot;` for `"`
- `&ldquo;` / `&rdquo;` for curly quotes

## Prisma (Vercel blocker)
We’ve hit a TypeScript build failure from Prisma args:

- **Never use `select` and `include` together** in the same Prisma query.
- If you need relation fields while selecting, use nested `select` instead:

  - Good:
    - `select: { id: true, members: { where: { userId }, select: { role: true } } }`
  - Also good:
    - `include: { members: { where: { userId }, select: { role: true } } }`

## Prisma schema safety (important)
- **Do not run `prisma db pull --force` and commit the resulting `prisma/schema.prisma` changes.**
  - This repo’s Prisma schema is **hand-maintained** with `@map` / `@@map` to keep **camelCase fields** and stable model names.
  - `db pull` will often rewrite models/fields to **snake_case** table/column names, which causes widespread TypeScript failures on Vercel.
- To test database connectivity, prefer:
  - `prisma generate`
  - `prisma migrate status`
  - A small “health” query via an API route (using the existing Prisma client)

## React hooks lint
- Avoid introducing new `react-hooks/exhaustive-deps` issues.
- If you intentionally exclude deps, add a short comment explaining why and disable only that line sparingly.

## Images / accessibility
- Prefer `next/image` for new UI.
- If using `<img>`, always include `alt` (meaningful text, or `alt=\"\"` if decorative).

## Tailwind
- Avoid adding classes that generate build warnings or are ambiguous.
- Prefer standard easing utilities (`ease-out`, `ease-in-out`) or set `style={{ transitionTimingFunction: 'cubic-bezier(...)' }}` instead of `ease-[...]` if it triggers warnings.

## Supabase / Vercel DB connectivity (common prod failure)
- For serverless (Vercel) deployments, prefer Supabase **Connection Pooler** (port `6543`) for `DATABASE_URL`.
- Add `?pgbouncer=true` when using the pooler.
- Avoid guidance that suggests editing only local `.env` for prod fixes — Vercel uses its own env vars.

## React Best Practices Skill
- The `react-best-practices` skill from Vercel Engineering is integrated and available.
- This skill provides comprehensive performance optimization guidelines for React and Next.js.
- When writing, reviewing, or refactoring React/Next.js code, follow the patterns in `src/lib/skills/react-best-practices.skill.md`.
- Priority focus areas: eliminating waterfalls, bundle size optimization, server-side performance, and re-render optimization.


